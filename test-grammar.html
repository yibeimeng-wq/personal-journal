<!DOCTYPE html>
<html>
<head>
  <title>Grammar Test</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    .grammar-item { padding: 10px; margin: 5px 0; background: #fff9e6; border: 1px solid #ffe082; cursor: pointer; }
    .original { color: red; text-decoration: line-through; }
    .suggestion { color: green; font-weight: bold; }
    #grammar-panel { display: none; background: #f5f5f5; padding: 15px; margin-top: 20px; border-radius: 8px; }
  </style>
</head>
<body>
  <h2>Grammar Checker Test</h2>
  
  <textarea id="test-content" rows="5" cols="50" placeholder="Type something with typos...">i recieved teh mail yeasterday. i definately going to writting.</textarea>
  
  <div id="grammar-panel">
    <h4>✏️ Suggestions</h4>
    <div id="suggestion-list"></div>
  </div>

  <script>
// ============================================
// COPY OF THE FIXED checkGrammar() FUNCTION
// ============================================

function analyzeGrammar(text) {
  const suggestions = [];
  const patterns = [
    { regex: /\bi\b/g, suggestion: 'I', reason: 'Capitalize "I"' },
    { regex: /\brecieved\b/gi, suggestion: 'received', reason: 'Spelling' },
    { regex: /\bteh\b/gi, suggestion: 'the', reason: 'Typo' },
    { regex: /\byeasterday\b/gi, suggestion: 'yesterday', reason: 'Spelling' },
    { regex: /\bdefinately\b/gi, suggestion: 'definitely', reason: 'Spelling' },
    { regex: /\bwritting\b/gi, suggestion: 'writing', reason: 'Spelling' },
  ];

  patterns.forEach(pattern => {
    let match;
    while ((match = pattern.regex.exec(text)) !== null) {
      suggestions.push({
        original: match[0],
        suggestion: pattern.suggestion,
        reason: pattern.reason
      });
    }
  });

  return suggestions.slice(0, 8);
}

function checkGrammar() {
  const content = document.getElementById('test-content').value;
  
  console.log('Input:', content);
  
  // Auto-detect language
  const hasChinese = /[\u4e00-\u9fff]/.test(content);
  const hasEnglish = /[a-zA-Z]/.test(content);
  
  console.log('Has Chinese:', hasChinese);
  console.log('Has English:', hasEnglish);
  
  // Skip if no English
  if (!hasEnglish) {
    document.getElementById('grammar-panel').style.display = 'none';
    return;
  }

  const suggestions = analyzeGrammar(content);
  console.log('Suggestions found:', suggestions.length);
  console.log('Suggestions:', suggestions);
  
  if (suggestions.length > 0) {
    document.getElementById('grammar-panel').style.display = 'block';
    document.getElementById('suggestion-list').innerHTML = suggestions.map((s, i) => `
      <div class="grammar-item" onclick="applyFix(${i})">
        <span class="original">${s.original}</span> → <span class="suggestion">${s.suggestion}</span>
        <br><small>${s.reason}</small>
      </div>
    `).join('');
    
    window.pendingSuggestions = suggestions;
  } else {
    document.getElementById('grammar-panel').style.display = 'none';
  }
}

function applyFix(index) {
  const s = window.pendingSuggestions[index];
  const content = document.getElementById('test-content');
  content.value = content.value.replace(s.original, s.suggestion);
  checkGrammar(); // Re-check
  console.log('Applied fix:', s.original, '→', s.suggestion);
}

// ============================================
// TEST
// ============================================

// Run on input
document.getElementById('test-content').addEventListener('input', () => checkGrammar());

// Run once on load
setTimeout(() => {
  checkGrammar();
  console.log('=== TEST COMPLETE ===');
  console.log('If suggestions appear below, the fix works!');
}, 100);
  </script>
</body>
</html>
